<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8" />
  <title>Tactics Flashcards</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />

  <style>

    body {
      font-family: Arial, sans-serif;
      max-width: 900px;
      margin: 0 auto;
      padding: 16px;
    }

    h1 { text-align:center; }

    #top-center-buttons {
      display:flex;
      justify-content:center;
      gap:14px;
      margin-bottom:12px;
    }

    #topBar {
      display:flex;
      flex-wrap:wrap;
      gap:10px;
      justify-content:center;
      align-items:center;
      margin-bottom:12px;
      font-size:0.9em;
    }

    #card {
      text-align: center;
      border: 1px solid #ddd;
      padding: 15px;
      border-radius: 6px;
      max-width: 500px;
      margin: 0 auto;
    }

    #boardImg {
      width: 100%;
      max-width: 420px;
      margin-top:10px;
      border:1px solid #ccc;
    }

    button,
    select,
    input[type="file"] {
      padding: 8px 20px;
      border-radius: 999px;
      border: 1px solid #d0d7de;
      background: linear-gradient(to bottom, #ffffff, #f3f4f6);
      cursor: pointer;
      font-size: 0.9em;
      font-weight:500;
    }

    #controls { margin-top:15px; }

    #controls > div {
      display:flex;
      justify-content:center;
      gap:14px;
      flex-wrap:wrap;
      margin-bottom:10px;
    }

    #favoriteIndicator {
      font-size:1.4em;
      margin-left:5px;
      color:#999;
    }

    #favoriteIndicator.active {
      color:gold;
    }

    #bottom-file div { font-size:0.78em; opacity:0.8; }

    /* DARK MODE */
    .dark-mode { background:#141414; color:#eee; }
    .dark-mode #card { border-color:#444; }
    .dark-mode #boardImg { border-color:#555; }
    .dark-mode button,
    .dark-mode select,
    .dark-mode input[type="file"] {
      background:#2a2a2a;
      border-color:#666;
      color:#eee;
    }
    .dark-mode #favoriteIndicator { color:#666; }
    .dark-mode #favoriteIndicator.active { color:gold; }

    /* MOBILE OPTIMIZATION */
    @media(max-width:600px){

      #controls > div {
        display:grid;
        grid-template-columns:1fr 1fr;
        gap:10px;
        justify-items:center;
      }

      button,
      select,
      input[type="file"] {
        width:90%;
        max-width:220px;
        padding:6px 14px;
        font-size:0.82em;
      }

      #top-center-buttons {
        flex-direction:column;
      }
    }

  </style>

</head>


<body>

  <h1>Tactics Flashcards</h1>

  <div id="statusMsg" style="text-align:center; font-weight:700; margin-bottom:12px; color:green;"></div>

  <div style="text-align:center; font-size:0.9em; margin-bottom:15px;">
    <img src="/data/Sharpen cover.png" style="width:55%; max-width:230px; display:block; margin:0 auto 8px;">
    Source of tactical positions: from the book <em>Sharpen Your Tactics!</em><br>
    by Grandmasters Anatoly Lein & Boris Archangelsky
  </div>


  <div id="top-center-buttons">
    <button id="openFenBuilderBtn">Use lichess.org FEN Builder</button>

    <select id="themeSelect">
      <option value="light">Light background</option>
      <option value="dark">Dark background</option>
    </select>
  </div>


  <div id="topBar">
    <button id="modeBtn">Mode: Random</button>
    <button id="jumpBtn">Go to problem number #</button>

    <select id="rangeSelect">
      <option value="">Choose Difficulty</option>
      <option value="1-10,12-14">***</option>
      <option value="11,15">****</option>
    </select>
  </div>



  <div id="card">

    <div id="problemCounter" style="margin-bottom:8px; font-weight:700; font-size:1.1em; color:#0a7c24;"></div>

    <img id="boardImg">

    <div id="controls">

      <div>
        <button id="previous-btn">← Previous</button>
        <button id="next-btn">Next →</button>
        <button id="favorite-btn">★ Favorite</button>
        <span id="favoriteIndicator">☆</span>
      </div>

      <div id="bottom-file">
        <input type="file" id="upload" multiple accept="image/*">
        <div>(Upload only images and screenshots)</div>
        <div style="font-size:0.8em; color:#b91c1c; margin-top:4px;">Images you upload are temporary – lost on refresh</div>
      </div>

    </div>

  </div>


<script>

let TOTAL = parseInt(prompt("How many images are in your 'problems' folder?"));

if (!Number.isFinite(TOTAL) || TOTAL < 1) TOTAL = 15;

document.getElementById("statusMsg").textContent = "Default (15) images loaded";

let mode = "random";

const cards = [];

for (let i = 1; i <= TOTAL; i++) {
  cards.push({
    id: i,
    image: `problems/problem_${i}.png`,
    favorite:false
  });
}

const boardImg = document.getElementById("boardImg");


function showCard(i){
  const c = cards[i];
  boardImg.src = c.image;

  document.getElementById("problemCounter").textContent =
    "Problem " + (i+1) + " of " + cards.length;

  const star = document.getElementById("favoriteIndicator");
  star.textContent = c.favorite ? "★" : "☆";
  star.classList.toggle("active", c.favorite);
}

let currentIndex = 0;
showCard(currentIndex);

document.getElementById("next-btn").onclick = ()=>{
  currentIndex = (currentIndex+1)%cards.length;
  showCard(currentIndex);
};

document.getElementById("previous-btn").onclick = ()=>{
  currentIndex = (currentIndex-1+cards.length)%cards.length;
  showCard(currentIndex);
};

document.getElementById("favorite-btn").onclick = ()=>{
  cards[currentIndex].favorite = !cards[currentIndex].favorite;
  showCard(currentIndex);
};

document.getElementById("jumpBtn").onclick = ()=>{
  const v = parseInt(prompt("Enter number (1-"+cards.length+")"));
  if(v>=1 && v<=cards.length){
    currentIndex = v-1;
    showCard(currentIndex);
  }
};

document.getElementById("rangeSelect").onchange = e => {
  const v = e.target.value;
  if(!v) return;
  const arr=[];
  v.split(",").forEach(s=>{
    if(s.includes("-")){
      let[a,b]=s.split("-").map(Number);
      for(let x=a;x<=b;x++) arr.push(x);
    } else arr.push(Number(s));
  });
  currentIndex = arr[Math.floor(Math.random()*arr.length)]-1;
  showCard(currentIndex);
};

document.getElementById("themeSelect").onchange = ()=>{
  if(themeSelect.value==="dark") document.body.classList.add("dark-mode");
  else document.body.classList.remove("dark-mode");
};

document.getElementById('openFenBuilderBtn').onclick=()=>{
  window.open("https://lichess.org/editor","_blank");
};

</script>

</body>
</html>
